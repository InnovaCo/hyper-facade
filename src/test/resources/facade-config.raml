#%RAML 1.0
title: Facade API
version: v1
mediaType: application/json
types:
  Status:
    type: object
    properties:
      statusCode: number
      processedBy:
        (privateField):
        type: string

  StatusRequest:
    type: object
    properties:
      serviceType: string

  TestRequest:
    type: object
    properties:
      mode: string
      resultType: string
      clientIP:
        (x-client-ip):
        type: string
      clientLanguage:
        (x-client-language):
        type: string

  ResourceRequest:
    type: object
    properties:
      url: string
      method: string

  ResourceState:
    type: object
    properties:
      content: string

  ResourceUpdate:
    type: object
    properties:
      update: string

  ReliableResourceState:
    type: object
    properties:
      revisionId: number
      content: string

  ReliableResourceUpdate:
    type: object
    properties:
      revisionId: number
      update: string

annotationTypes:
  x-client-ip:
  x-client-language:
  privateField:

traits:
  streamed-unreliable:
    queryParameters:
      <<resourceStateUri>>:
      <<eventFeedUri>>:
  streamed-reliable:
    queryParameters:
      <<resourceStateUri>>:
      <<eventFeedUri>>:
  plain-resource:
    queryParameters:
      <<resourceStateUri>>:
  secured:
  paged:
  rateLimited:
  privateResource:

/users:
  is: [ secured ]
  get:
    is: [ paged, rateLimited ]
    body:
      type: StatusRequest
    headers:
      authToken:
    responses:
      200:
        body:
          type: Status
        headers:
          content-type:

/status:
  post:
    is: [ rateLimited ]
  /test-service:
    get:
      is: [ paged ]
      body:
        type: TestRequest
      headers:
        authToken:
      responses:
        200:
          body:
            type: Status
          headers:
            content-type:
        404:
          body:
            type: string

/private:
  is: [ privateResource ]

/unreliable-feed:
  is: [ streamed-unreliable: { "resourceStateUri": "/unreliable-feed/resource", "eventFeedUri": "/unreliable-feed/{content}/events" } ]
  post:
    body:
      application/vnd+app-server-status.json:
        type: ResourceState
      application/vnd+app-server-status-update.json:
        type: ResourceUpdate

/reliable-feed:
  is: [ streamed-reliable: { "resourceStateUri": "/reliable-feed/resource", "eventFeedUri": "/reliable-feed/{content}/events" } ]
  post:
    body:
      application/vnd+app-server-status.json:
        type: ReliableResourceState
      application/vnd+app-server-status-update.json:
        type: ReliableResourceUpdate

/test-service/reliable:
  post:
    is: [ streamed-reliable: { "resourceStateUri": "/test-service/reliable/resource", "eventFeedUri": "/test-service/reliable/{content}/events" } ]

/test-service/unreliable:
  post:
    is: [ streamed-unreliable: { "resourceStateUri": "/test-service/unreliable/resource", "eventFeedUri": "/test-service/unreliable/{content}/events" } ]

/perf-test-service/ws:
  post:
    is: [ streamed-unreliable: { "resourceStateUri": "/test-service/unreliable/resource", "eventFeedUri": "/test-service/unreliable/{content}/events" } ]